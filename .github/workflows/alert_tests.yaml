name: alert-test
run-name: run unit and conformance tests

on:
  pull_request:
    # Only run on PRs based on the main branch
    branches:
      - main

jobs:
  rules-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1
        with:
          fetch-depth: "0"
      - name: run rules tests
        run: make test-rules
  inhibition-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1
        with:
          fetch-depth: "0"
      - name: run inhibition tests
        run: make test-inhibitions
  runbook-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1
        with:
          fetch-depth: "0"
      - name: Clone intranet repository
        uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1
        with:
          fetch-depth: 1
          repository: giantswarm/giantswarm
          path: giantswarm
          token: ${{ secrets.TAYLORBOT_GITHUB_ACTION }}
      - name: run runbook tests
        env:
          RUNBOOKS_DIR: ./giantswarm
        run: make test-ci-runbooks
  prometheus-lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1
        with:
          fetch-depth: "0"
      - name: run pint linter
        run: make pint
