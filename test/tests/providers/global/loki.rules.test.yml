---
rule_files:
  - loki.all.rules.yml

tests:
  - interval: 1m
    input_series:
      - series: '{app="loki-compactor", cluster_id="zj88t", container="compactor", customer="giantswarm", installation="gorilla", name="compactor", namespace="loki", organization="giantswarm-production", pod="loki-compactor-676b8c897b-rq298"}'
        values: "0+0x20 1+0x40"
    alert_rule_test:
      - alertname: LokiRingUnhealthy
        eval_time: 40m
        exp_alerts: 
          - exp_labels:
              area: managedservices
              cancel_if_apiserver_down: "true"
              cancel_if_cluster_status_creating: "true"
              cancel_if_cluster_status_deleting: "true"
              cancel_if_cluster_status_updating: "true"
              cancel_if_scrape_timeout: "true"
              cancel_if_outside_working_hours: "true"
              severity: page
              team: atlas
              topic: observability
            exp_annotations:
              description: "Loki pod loki-compactor-676b8c897b-rq298 (namespace loki) sees 1 unhealthy ring members"
              opsrecipe: "loki/"
