---
rule_files:
- prometheus-agent.rules.yml

tests:
  - interval: 1m
    input_series:
      - series: 'up{instance="prometheus-agent",cluster_type="workload_cluster",cluster_id="gauss",installation="myinstall"}'
        values: "_x60  0+0x60 1+0x60"
    alert_rule_test:
      - alertname: PrometheusAgentFailing
        eval_time: 30m
        exp_alerts:
          - exp_labels:
              area: empowerment
              severity: page
              team: atlas
              topic: observability
              inhibit_prometheus_agent_down: "true"
              instance: prometheus-agent
              cancel_if_cluster_is_not_running_prometheus_agent: "true"
              cancel_if_cluster_status_creating: "true"
              cancel_if_cluster_status_deleting: "true"
              cancel_if_outside_working_hours: "true"
            exp_annotations:
              dashboard: "promRW001/prometheus-remote-write"
              description: "Prometheus agent remote write is failing."
              opsrecipe: "prometheus-agent-remote-write-failed/"
              summary: "Prometheus agent fails to send samples to remote write endpoint."
      - alertname: PrometheusAgentFailing
        eval_time: 90m
        exp_alerts:
          - exp_labels:
              area: empowerment
              cluster_id: gauss
              cluster_type: workload_cluster
              severity: page
              team: atlas
              topic: observability
              inhibit_prometheus_agent_down: "true"
              installation: myinstall
              instance: prometheus-agent
              cancel_if_cluster_is_not_running_prometheus_agent: "true"
              cancel_if_cluster_status_creating: "true"
              cancel_if_cluster_status_deleting: "true"
              cancel_if_outside_working_hours: "true"
            exp_annotations:
              dashboard: "promRW001/prometheus-remote-write"
              description: "Prometheus agent remote write is failing."
              opsrecipe: "prometheus-agent-remote-write-failed/"
              summary: "Prometheus agent fails to send samples to remote write endpoint."
      - alertname: PrometheusAgentFailing
        eval_time: 150m
